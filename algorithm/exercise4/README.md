# 习题四

## 描述
试分析比较快速排序和归并排序在平均情况下的元素移动次数。

## 解答
### 快速排序
在一次比较过程中，假设元素个数为`n`，对于每个元素可能移动，也可能不移动。选定的`splitPoint`出现的位置的概率也相等，其也是可能移动不可能移动的，并且之间是相互独立的。假设对每个元素来说，移动和不移动的概率相同，那么在这次比较中移动次数的平均情况为：
$$ \frac{n}{2} $$
那么由于`splitPoint`出现的位置的概率也是相等的，那么有：
$$ A(n) = \frac{n}{2} + \frac{1}{n}\sum_{i = 0}^{n - 1}{\Big(A(i) + A(n - 1 - i)\Big)} \qquad n \geqslant 2 $$
$$ A(1) = A(0) = 0 $$
对上面的公式进行整理有
$$ A(n) = \frac{n}{2} + \frac{2}{n}\sum_{i = 1}^{n - 1}{A(i)} \qquad n \geqslant 1 $$
那么可以进行近似假设，假设每次都将序列分成长度相同的两个子序列，那么可以得到下面近似的结果：
$$ A(n) \thickapprox \frac{n}{2} + 2A(\frac{n}{2}) \to A(n) \in \Theta(n\log n) $$

### 归并排序
按照递归的思想：最后一次合并的都是两个大小为1的数组，两个元素要么移动，要么不移动，因此平均情况下元素移动的次数为$\frac{1}{2}$。总共有$\frac{n}{2}$组，那么最后一次合并的时候发生元素移动的平均为$\frac{1}{2} * \frac{n}{2} = \frac{n}{4}$。紧接着对两个大小为2的排好顺序的数组进行合并，平均情况下移动次数为$\frac{1}{2} * 2 = 1$，共有$\frac{n}{4}$组，那么总次数为$1 * \frac{n}{4} = \frac{n}{4}$。以此进行类推，实际每次迭代元素移动的次数为$\frac{n}{4}$。根据2路归并的思想，总共要进行$\log n$次递归调用，那么最终的平均情况下元素移动的次数为:
$$\log n * \frac{n}{4} = \frac{n}{4}\log n$$
